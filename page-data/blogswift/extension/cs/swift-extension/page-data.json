{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogswift/extension//cs/swift-extension/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://dannypsnl.github.io"}},"markdownRemark":{"html":"<p>雖然 apple 在<code class=\"language-text\">extension</code>的文件中註記了</p>\n<blockquote>\n<p>NOTE<br>\nIf you define an extension to add new functionality to an existing type, the new functionality will be available on all existing instances of that type, even if they were created before the extension was defined.</p>\n</blockquote>\n<p>這樣的事實</p>\n<p>你仍然不應該在不是定義<code class=\"language-text\">extension</code>的地方使用該屬性，這樣的分散性會導致未來的維護困難重重</p>\n<ul>\n<li>在 goto 被視作優良設計的年代，我們問「所以究竟是從哪裡來？是執行了 a 區塊還是 b 區塊再執行我？」</li>\n<li>在 callback 盛行的時候，我們問「究竟什麼時後執行了 callback？」</li>\n<li>在共時的世界，我們問「是誰改變了狀態？」</li>\n</ul>\n<p>每個設計都是一種抉擇，抉擇之後必然有其優勢與劣勢，問題在於如何善用優勢，而不是造成更多問題</p>\n<p><code class=\"language-text\">extension</code>啊<code class=\"language-text\">extension</code>，你比都定義在<code class=\"language-text\">class</code>好？</p>\n<p>讓我們看看傳統的<code class=\"language-text\">class</code>如何做一個<code class=\"language-text\">cm =&gt; m</code></p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Meter</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> _v <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    _v <span class=\"token operator\">=</span> v\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">var</span> cm<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> _v<span class=\"token operator\">/</span><span class=\"token number\">100.0</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> onehundredCm <span class=\"token operator\">=</span> <span class=\"token function\">Meter</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>cm</code></pre></div>\n<p>這個實作語意不明，究竟是 100 公尺轉換成公分，還是公分變公尺？</p>\n<p>如果我們想要更加明確的語意，就需要定義大量的輔助類別</p>\n<p>例如：</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">cm</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> _v<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span>\n    <span class=\"token keyword\">var</span> cm<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> _v <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        _v <span class=\"token operator\">=</span> v\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">toM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Meter</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">Meter</span><span class=\"token punctuation\">(</span>_v<span class=\"token operator\">/</span><span class=\"token number\">100.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> onehundredCm <span class=\"token operator\">=</span> <span class=\"token function\">cm</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>m\n<span class=\"token keyword\">let</span> oneMeter <span class=\"token operator\">=</span> <span class=\"token function\">Meter</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toCM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>cm</code></pre></div>\n<p>不但複雜，而且可讀性依然有限</p>\n<p>那<code class=\"language-text\">extension</code>呢？(以下做法來自 apple developer 網站的簡化)</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">Double</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> m<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">self</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">var</span> cm<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">self</span><span class=\"token operator\">/</span><span class=\"token number\">100.0</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> onehundredCm <span class=\"token operator\">=</span> <span class=\"token number\">100.0</span><span class=\"token punctuation\">.</span>cm</code></pre></div>\n<p>哇，看起來好多了，對吧！</p>\n<p>請考慮</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> n <span class=\"token operator\">=</span> <span class=\"token number\">100.0</span><span class=\"token punctuation\">.</span>cm<span class=\"token punctuation\">.</span>cm\n<span class=\"token comment\">// Oops，這是什麼鬼？</span></code></pre></div>\n<p><code class=\"language-text\">extension</code>讓我們能對原生型別進行改動，但也使客戶端需要有更好的意志克制自己亂用的衝動</p>\n<p>在 effective C++中，Scott Meyer 提到，類別的所有介面都應該是透過方法</p>\n<p>他的論點如下：</p>\n<blockquote>\n<p>如果你的介面有一個變數，那麼使用者可以對它進行改動，而這個改動可能並非你設計此型別時考慮過的使用順序(這也是 C 語言的弱點所在，它仰仗使用者知道自己在幹嘛，雖然通常不是那樣)，進而導致無解的 bug，而這個 bug 導致使用者不用你的程式庫了！即便這不是你的問題，然而你仍要為此負責</p>\n</blockquote>\n<p>而方法的更多優點是，你可能會驗證傳入的值，再進行對值的改動，而使用方法做為介面者，可以在完全不影響客戶端程式碼的情況下完成新設計，此論點確實值得一試</p>\n<p>回到 extension</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> <span class=\"token builtin\">IWalk</span> <span class=\"token operator\">=</span> <span class=\"token number\">30.0</span><span class=\"token punctuation\">.</span>km <span class=\"token operator\">+</span> <span class=\"token number\">20.0</span><span class=\"token punctuation\">.</span>m</code></pre></div>\n<p><code class=\"language-text\">extension</code>給了你很好的彈性來設計一門優良的限定領域語言，而這不需要太複雜的技術與知識，只需要簡單的加上幾個屬性</p>\n<p>再回到一開始的狀況，事實上，對於該問題，只使用<code class=\"language-text\">extension</code>或<code class=\"language-text\">類別</code>都是錯的</p>\n<p>混用才能達成我們心目中的效果</p>\n<p>例如：</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">Double</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> cm<span class=\"token punctuation\">:</span> <span class=\"token constant\">CM</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">CM</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CM</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> _v<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">toM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Double</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">Meter</span><span class=\"token punctuation\">(</span>_v<span class=\"token operator\">/</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>_v\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Double</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        _v <span class=\"token operator\">=</span> v\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>使用起來就像</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> onehundredCm <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">.</span>cm<span class=\"token punctuation\">.</span><span class=\"token function\">toM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>少了一些彈性，但是出現奇怪行為的機會也因此下降，更重要的是盡量不要擴展基本型別，這件事帶來的壞處往往大於好處</p>\n<p>那麼<code class=\"language-text\">extension</code>適合哪些狀況呢？</p>\n<p>第一，利用此特性可以減少你需要打的字，而且能夠提升程式碼的可理解性，例如替容器型別定義<code class=\"language-text\">subscript</code>運算子</p>\n<p>第二，限定於此情此景的函數解決方案，例如在一個解析器裡，只有在印出錯誤訊息時，我們才會關心錯誤發生在哪，這時候再定義一個<code class=\"language-text\">positionFormat</code>函數格式化輸出</p>\n<p>第三，型別定義太過冗長，這時在同一個檔案裡用<code class=\"language-text\">extension</code>替函數分組也是不錯的寫法</p>\n<p>好吧，你問為什麼特化解法寫在<code class=\"language-text\">extension</code>，你就這麼確定其他地方用不上？</p>\n<p>當然不是，只是其他地方用上的時候，把<code class=\"language-text\">extension</code>移到型別定義的檔案中就好</p>\n<p>這時就變成了 3 的情況啦</p>","frontmatter":{"title":"Swift --extension概念入門","categories":["cs"],"tags":["swift","extension"]}}},"pageContext":{"slug":"/blogswift/extension//cs/swift-extension/"}}}