{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2019/11/24/cs/on-working-effectively-with-legacy-code-part-one/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://dannypsnl.github.io"}},"markdownRemark":{"html":"<p>Preface author defines: what is legacy code? The code which lack of tests.</p>\n<p>Keep going on, at chapter 1 author compares reasons we update the code.</p>\n<ol>\n<li>New Feature</li>\n<li>Fix Bug</li>\n<li>Refactor</li>\n<li>Optimize</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Feature</th>\n<th>Bug</th>\n<th>Refactor</th>\n<th>Optimize</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>structure</td>\n<td>O</td>\n<td>O</td>\n<td>O</td>\n<td></td>\n</tr>\n<tr>\n<td>new feature</td>\n<td>O</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>old feature</td>\n<td></td>\n<td>O</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>resource usage</td>\n<td></td>\n<td></td>\n<td></td>\n<td>O</td>\n</tr>\n</tbody>\n</table>\n<p>And when changing code, most of the features are we don't want to change.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 521px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.513513513513512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjUlEQVQI12WLUQuCMBhF/f9/qtcomU0RHyaNRQkZGESyFLdTuhlBFy58nHu+pGgO5E0WesmQZ4EwO7JTyv64XVix7rHFh+XXHJVueNQ1HnDOMSdx3rE0gnEcsdZiX5b21jJNE957vt6vOwzcu441s5eEIwBjDGVZIoSgf/bR4i8+PmitqaoKKSVKqYW9AQK04rpya98PAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"figure1\"\n        title=\"figure1\"\n        src=\"/static/5ee195bc5b70e773596930f100a13f35/bb9c5/figure1.png\"\n        srcset=\"/static/5ee195bc5b70e773596930f100a13f35/12f09/figure1.png 148w,\n/static/5ee195bc5b70e773596930f100a13f35/e4a3f/figure1.png 295w,\n/static/5ee195bc5b70e773596930f100a13f35/bb9c5/figure1.png 521w\"\n        sizes=\"(max-width: 521px) 100vw, 521px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Question: How can we sure features are working as usual?</p>\n<p>Chapter 2 answers the question: Working with the response, the idea was to use tests as software vise.</p>\n<p>And not just has responses, we want them to reply as soon as possible. So unit tests should more than QA tests.</p>\n<p>But we would have a problem that legacy code needs a test to ensure safety change, however, add test need to change legacy code.</p>\n<p>Chapter 3, we finally start with the technology we need, ideally, we can test any class without code change. That's why that's ideal. We have to change the code. But first is when? The author says there are two reasons:</p>\n<ol>\n<li>get value: when we can't get the result of the computation</li>\n<li>separate: when we can't execute some code independently</li>\n</ol>\n<p>And here, the author mentions the first technology: fake collaborators.</p>\n<p>The example from the book is not quite important, anyway, we mock some components with side effects to remove side effects. We can extend a fake object to a mock object. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Stdout</span> mockStdout <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MockStdout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmockStdout<span class=\"token punctuation\">.</span><span class=\"token function\">setExpectation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"println\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello, world\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">TestTarget</span> testTarget <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TestTarget</span><span class=\"token punctuation\">(</span>mockStdout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntestTarget<span class=\"token punctuation\">.</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In the test, we says that <code class=\"language-text\">println</code> would be called with argument <code class=\"language-text\">&quot;hello, world&quot;</code>.</p>\n<p>Chapter 4: Seam model</p>\n<p>Seam: a special point that we can change its behavior without change that code.</p>\n<p>For example, a global function was called in a method:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Foo</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">void</span> <span class=\"token function\">wow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token function\">global_function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We can override it:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Foo</span> <span class=\"token punctuation\">{</span>\n  virutal <span class=\"token keyword\">void</span> <span class=\"token function\">global_function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> Foo<span class=\"token operator\">::</span><span class=\"token function\">global_function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">::</span><span class=\"token function\">global_function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And create a subclass of <code class=\"language-text\">Foo</code> then override <code class=\"language-text\">global_function()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">TestFoo</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">public</span> Foo <span class=\"token punctuation\">{</span>\n  virutal <span class=\"token keyword\">void</span> <span class=\"token function\">global_function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, we disable side effects from <code class=\"language-text\">global_function</code>.</p>\n<p>In fact, the author mentions several different ways for the seam, but anyway I think everyone can find out how to do this in the language they are using.</p>\n<p>Chapter 5 is for tools</p>\n<ul>\n<li>refactoring tool: IDE is super good for this purpose</li>\n<li>mock object framework</li>\n<li>unit test tool: JUnit, CppUnit ...</li>\n<li>integration test: FIT, Fitnesse ...</li>\n</ul>\n<p>Now part one ended, to be honest, most of the thing was I already know, in fact, I suggest people skip this part when reading this book. Because this book published in 2005, a lot of thing was outdated, especially those about tools. And I think most people already know we need to write tests. In fact, I think the problem currently was we don't know how to write a good test. But I can promise that the second part was interesting X).</p>","frontmatter":{"title":"Reflection on Working effectively with legacy code --- Part I","categories":["cs"],"tags":["programming","testing"]}}},"pageContext":{"slug":"/blog/2019/11/24/cs/on-working-effectively-with-legacy-code-part-one/"}}}