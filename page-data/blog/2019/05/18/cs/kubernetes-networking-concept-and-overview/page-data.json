{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2019/05/18/cs/kubernetes-networking-concept-and-overview/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://dannypsnl.github.io"}},"markdownRemark":{"html":"<p>Kubernetes was built to run distributed systems on a cluster of nodes. Understanding the concept of kubernetes networking could help you correctly understanding how to run, monitor and trouble shooting your applications on kubernetes, even more you can know how to choosing the suitable distributed system for yourself by knowing how to comparing them well.</p>\n<p>To understand it's networking configuration, we have to start from container and how the operating system provides these resource isolations. We start from <code class=\"language-text\">network namespace</code> this concept of Linux, and create a mock environment for learning how it works as container does. Now, let's begin!</p>\n<h3>1 Network namespace</h3>\n<p>Before we start, my environment is <code class=\"language-text\">Ubuntu 18.04 LTS</code>, and here is the kernel information:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">uname</span> -a\nLinux test-linux <span class=\"token number\">4.15</span>.0-1032-gcp <span class=\"token comment\">#34-Ubuntu SMP Wed May 8 13:02:46 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></code></pre></div>\n<h4>1.1 Create new network namespace</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># create network namespace net0</span>\n$ <span class=\"token function\">ip</span> netns <span class=\"token function\">add</span> net0\n<span class=\"token comment\"># create network namespace net1</span>\n$ <span class=\"token function\">ip</span> netns <span class=\"token function\">add</span> net1\n<span class=\"token comment\"># then check</span>\n$ <span class=\"token function\">ip</span> netns list\nnet1\nnet0 <span class=\"token punctuation\">(</span>id: <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now we have several network namespaces could emit process on it, but the process can't connect to other networks is meaningless. To solve this problem, we have to create a tunnel for them, in Linux, we can use <code class=\"language-text\">veth pair</code> to connect two namespaces directly.</p>\n<h4>1.2 Create veth pair</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># new veth pair</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">type</span> veth\n<span class=\"token comment\"># assign veth0 to net0</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> veth0 netns net0\n<span class=\"token comment\"># assign veth1 to net1</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> veth1 netns net1\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> veth0 up\n<span class=\"token comment\"># assign ip 10.0.1.2 to veth0, you can use `ip addr` to check it</span>\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">ip</span> addr <span class=\"token function\">add</span> <span class=\"token number\">10.0</span>.1.2/24 dev veth0\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net1 <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> veth1 up\n<span class=\"token comment\"># assign ip 10.0.1.3 to veth1</span>\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net1 <span class=\"token function\">ip</span> addr <span class=\"token function\">add</span> <span class=\"token number\">10.0</span>.1.3/24 dev veth1</code></pre></div>\n<blockquote>\n<p>NOTE: An important thing is <code class=\"language-text\">veth pair</code> can't exist alone if you remove one, another would be removed.</p>\n</blockquote>\n<p>Now, <code class=\"language-text\">ping</code> the network namespace <code class=\"language-text\">net1</code> from <code class=\"language-text\">net0</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">ping</span> <span class=\"token number\">10.0</span>.1.3 -c <span class=\"token number\">3</span></code></pre></div>\n<p><code class=\"language-text\">tcpdump</code> from target network namespace, of course, you should run <code class=\"language-text\">tcpdump</code> before you <code class=\"language-text\">ping</code> it.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net1 tcpdump -v -n -i veth1\ntcpdump: listening on veth1, link-type EN10MB <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span>, capture size <span class=\"token number\">262144</span> bytes\n<span class=\"token number\">13</span>:54:11.800223 IP6 <span class=\"token punctuation\">(</span>hlim <span class=\"token number\">255</span>, next-header ICMPv6 <span class=\"token punctuation\">(</span><span class=\"token number\">58</span><span class=\"token punctuation\">)</span> payload length: <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> fe80::905d:ccff:fe4a:cd81 <span class=\"token operator\">></span> ff02::2: <span class=\"token punctuation\">[</span>icmp6 <span class=\"token function\">sum</span> ok<span class=\"token punctuation\">]</span> ICMP6, router solicitation, length <span class=\"token number\">16</span>\n          <span class=\"token builtin class-name\">source</span> link-address option <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">8</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>: <span class=\"token number\">92</span>:5d:cc:4a:cd:81\n<span class=\"token number\">13</span>:54:12.400440 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">45855</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>DF<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.2 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.3: ICMP <span class=\"token builtin class-name\">echo</span> request, <span class=\"token function\">id</span> <span class=\"token number\">1433</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">13</span>:54:12.400464 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">41348</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>none<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.3 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.2: ICMP <span class=\"token builtin class-name\">echo</span> reply, <span class=\"token function\">id</span> <span class=\"token number\">1433</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">13</span>:54:13.464163 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">45912</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>DF<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.2 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.3: ICMP <span class=\"token builtin class-name\">echo</span> request, <span class=\"token function\">id</span> <span class=\"token number\">1433</span>, <span class=\"token function\">seq</span> <span class=\"token number\">2</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">13</span>:54:13.464189 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">41712</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>none<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.3 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.2: ICMP <span class=\"token builtin class-name\">echo</span> reply, <span class=\"token function\">id</span> <span class=\"token number\">1433</span>, <span class=\"token function\">seq</span> <span class=\"token number\">2</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">13</span>:54:14.488184 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">46671</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>DF<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.2 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.3: ICMP <span class=\"token builtin class-name\">echo</span> request, <span class=\"token function\">id</span> <span class=\"token number\">1433</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">13</span>:54:14.488221 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">41738</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>none<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.3 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.2: ICMP <span class=\"token builtin class-name\">echo</span> reply, <span class=\"token function\">id</span> <span class=\"token number\">1433</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3</span>, length <span class=\"token number\">64</span></code></pre></div>\n<p><strong>HTTP</strong> can work also.</p>\n<p><strong>HTTP</strong> server:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net1 python3 -m http.server\nServing HTTP on <span class=\"token number\">0.0</span>.0.0 port <span class=\"token number\">8000</span> <span class=\"token punctuation\">..</span>.\n<span class=\"token comment\"># After you execute the following command here would show</span>\n<span class=\"token number\">10.0</span>.1.2 - - <span class=\"token punctuation\">[</span><span class=\"token number\">15</span>/May/2019 <span class=\"token number\">13</span>:55:41<span class=\"token punctuation\">]</span> <span class=\"token string\">\"GET / HTTP/1.1\"</span> <span class=\"token number\">200</span> -</code></pre></div>\n<p><strong>HTTP</strong> client:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">curl</span> <span class=\"token number\">10.0</span>.1.3:8000\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>DOCTYPE HTML PUBLIC <span class=\"token string\">\"-//W3C//DTD HTML 4.01//EN\"</span> <span class=\"token string\">\"http://www.w3.org/TR/html4/strict.dtd\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>meta http-equiv<span class=\"token operator\">=</span><span class=\"token string\">\"Content-Type\"</span> <span class=\"token assign-left variable\">content</span><span class=\"token operator\">=</span><span class=\"token string\">\"text/html; charset=utf-8\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span>Directory listing <span class=\"token keyword\">for</span> /<span class=\"token operator\">&lt;</span>/title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>Directory listing <span class=\"token keyword\">for</span> /<span class=\"token operator\">&lt;</span>/h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>\n<span class=\"token operator\">&lt;</span>hr<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\".bash_history\"</span><span class=\"token operator\">></span>.bash_history<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\".bash_logout\"</span><span class=\"token operator\">></span>.bash_logout<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\".bashrc\"</span><span class=\"token operator\">></span>.bashrc<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\".config/\"</span><span class=\"token operator\">></span>.config/<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\".docker/\"</span><span class=\"token operator\">></span>.docker/<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\".profile\"</span><span class=\"token operator\">></span>.profile<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\".theia/\"</span><span class=\"token operator\">></span>.theia/<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\"README-cloudshell.txt\"</span><span class=\"token operator\">></span>README-cloudshell.txt@<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/ul<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>hr<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/html<span class=\"token operator\">></span></code></pre></div>\n<p>Although <code class=\"language-text\">veth pair</code> could help you connect two network namespaces, however, it can't work with more. While we are working on an environment with more than two network namespaces, we would need a more powerful technology: Bridge.</p>\n<h4>1.3 Create a virtual bridge</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># create bridge</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token function\">add</span> br0 <span class=\"token builtin class-name\">type</span> bridge\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev br0 up\n<span class=\"token comment\"># create veth pair for net0, veth0 &amp; veth1</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">type</span> veth\n<span class=\"token comment\"># create veth pair for net1, veth2 &amp; veth3</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">type</span> veth\n<span class=\"token comment\"># set up veth pair of net0</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth0 netns net0\n<span class=\"token comment\"># You would find veth0 disappeared now by `ip link`</span>\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth0 name eth0\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">ip</span> addr <span class=\"token function\">add</span> <span class=\"token number\">10.0</span>.1.2/24 dev eth0\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev eth0 up\n<span class=\"token comment\"># bind veth pair of net0 to br0</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth1 master br0\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth1 up\n<span class=\"token comment\"># set up veth pair of net1</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth2 netns net1\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net1 <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth2 name eth0\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net1 <span class=\"token function\">ip</span> addr <span class=\"token function\">add</span> <span class=\"token number\">10.0</span>.1.3/24 dev eth0\n$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net1 <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev eth0 up\n<span class=\"token comment\"># bind veth pair of net1 to br0</span>\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth3 master br0\n$ <span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev veth3 up</code></pre></div>\n<p>Now, ping <code class=\"language-text\">10.0.1.3</code> from <code class=\"language-text\">net0</code> to check our bridge network.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ip</span> netns <span class=\"token builtin class-name\">exec</span> net0 <span class=\"token function\">ping</span> <span class=\"token number\">10.0</span>.1.3 -c <span class=\"token number\">3</span>\nPING <span class=\"token number\">10.0</span>.1.3 <span class=\"token punctuation\">(</span><span class=\"token number\">10.0</span>.1.3<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.030</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.059</span> ms\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.0</span>.1.3: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.051</span> ms\n\n--- <span class=\"token number\">10.0</span>.1.3 <span class=\"token function\">ping</span> statistics ---\n<span class=\"token number\">3</span> packets transmitted, <span class=\"token number\">3</span> received, <span class=\"token number\">0</span>% packet loss, <span class=\"token function\">time</span> 2038ms\nrtt min/avg/max/mdev <span class=\"token operator\">=</span> <span class=\"token number\">0.030</span>/0.046/0.059/0.014 ms</code></pre></div>\n<p><code class=\"language-text\">tcpdump</code> our bridge: <code class=\"language-text\">br0</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ tcpdump -v -n -i br0\ntcpdump: listening on br0, link-type EN10MB <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span>, capture size <span class=\"token number\">262144</span> bytes\n<span class=\"token number\">12</span>:43:39.619458 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">63269</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>DF<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.2 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.3: ICMP <span class=\"token builtin class-name\">echo</span> request, <span class=\"token function\">id</span> <span class=\"token number\">3046</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">12</span>:43:39.619553 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">54235</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>none<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.3 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.2: ICMP <span class=\"token builtin class-name\">echo</span> reply, <span class=\"token function\">id</span> <span class=\"token number\">3046</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">12</span>:43:40.635730 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">63459</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>DF<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.2 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.3: ICMP <span class=\"token builtin class-name\">echo</span> request, <span class=\"token function\">id</span> <span class=\"token number\">3046</span>, <span class=\"token function\">seq</span> <span class=\"token number\">2</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">12</span>:43:40.635764 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">54318</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>none<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.3 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.2: ICMP <span class=\"token builtin class-name\">echo</span> reply, <span class=\"token function\">id</span> <span class=\"token number\">3046</span>, <span class=\"token function\">seq</span> <span class=\"token number\">2</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">12</span>:43:41.659714 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">63548</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>DF<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.2 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.3: ICMP <span class=\"token builtin class-name\">echo</span> request, <span class=\"token function\">id</span> <span class=\"token number\">3046</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">12</span>:43:41.659742 IP <span class=\"token punctuation\">(</span>tos 0x0, ttl <span class=\"token number\">64</span>, <span class=\"token function\">id</span> <span class=\"token number\">54462</span>, offset <span class=\"token number\">0</span>, flags <span class=\"token punctuation\">[</span>none<span class=\"token punctuation\">]</span>, proto ICMP <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, length <span class=\"token number\">84</span><span class=\"token punctuation\">)</span>\n    <span class=\"token number\">10.0</span>.1.3 <span class=\"token operator\">></span> <span class=\"token number\">10.0</span>.1.2: ICMP <span class=\"token builtin class-name\">echo</span> reply, <span class=\"token function\">id</span> <span class=\"token number\">3046</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3</span>, length <span class=\"token number\">64</span>\n<span class=\"token number\">12</span>:43:44.859619 ARP, Ethernet <span class=\"token punctuation\">(</span>len <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>, IPv4 <span class=\"token punctuation\">(</span>len <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>, Request who-has <span class=\"token number\">10.0</span>.1.2 tell <span class=\"token number\">10.0</span>.1.3, length <span class=\"token number\">28</span>\n<span class=\"token number\">12</span>:43:44.859638 ARP, Ethernet <span class=\"token punctuation\">(</span>len <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>, IPv4 <span class=\"token punctuation\">(</span>len <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>, Request who-has <span class=\"token number\">10.0</span>.1.3 tell <span class=\"token number\">10.0</span>.1.2, length <span class=\"token number\">28</span>\n<span class=\"token number\">12</span>:43:44.859686 ARP, Ethernet <span class=\"token punctuation\">(</span>len <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>, IPv4 <span class=\"token punctuation\">(</span>len <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>, Reply <span class=\"token number\">10.0</span>.1.2 is-at 0a:e0:a1:07:b7:c9, length <span class=\"token number\">28</span>\n<span class=\"token number\">12</span>:43:44.859689 ARP, Ethernet <span class=\"token punctuation\">(</span>len <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>, IPv4 <span class=\"token punctuation\">(</span>len <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>, Reply <span class=\"token number\">10.0</span>.1.3 is-at d2:b6:de:2f:4e:f6, length <span class=\"token number\">28</span></code></pre></div>\n<p>As you thought, <code class=\"language-text\">br0</code> would get the traffic from <code class=\"language-text\">net0</code> to <code class=\"language-text\">net1</code>, now we have topology looks like:</p>\n<h5>Figure 1.1</h5>\n<p><img src=\"/static/bridge_mode_and_namespace-0fb13c1a95dddcb3a53c2ab3a9f4ca4a.svg\"></p>\n<p>At the final of the output of <code class=\"language-text\">tcpdump</code> we can see some ARP request/reply, we would talk about it in the next section.</p>\n<p>To get more info:</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Linux_namespaces\">wiki: linux namespace</a></li>\n</ul>\n<h3>2 ARP</h3>\n<p>ARP(Address Resolution Protocol) is a communication protocol used for discovering the link layer address, such as a MAC address associated with a given internet layer address.</p>\n<blockquote>\n<p>NOTE: In IPv6(Internet Protocol Version 6), the functionality of ARP provided by NDP(Neighbor Discovery Protocol).</p>\n</blockquote>\n<p>We aren't going to show the whole packet layout of ARP, but mention the part we care in the case.</p>\n<p>The working process is:</p>\n<ol>\n<li>send ARP request packet with source MAC and source IP and target IP to broadcast address</li>\n<li>the machine thought it has this target IP would send ARP reply packet contains it's MAC address</li>\n<li>the machine sends ARP request would cache the mapping of IP and MAC into ARP cache, so next time it doesn't have to send ARP request again.</li>\n</ol>\n<blockquote>\n<p>NOTE: others endpoint would ignore non-interested ARP request</p>\n</blockquote>\n<h5>Figure 2.1</h5>\n<p><img src=\"/static/arp_request_and_reply-075cc7b4321fc02f7afc99d7dbbd76c2.svg\"></p>\n<p>At the previous section, we can see both sides send ARP request to get another IP's information.</p>\n<p>To get more info:</p>\n<ul>\n<li><a href=\"https://tools.ietf.org/html/rfc826\">RFC 826</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Address_Resolution_Protocol\">wiki: ARP</a></li>\n</ul>\n<h3>3 Pod to Pod</h3>\n<p><strong>Pod</strong> is the unit of kubernetes, so the most basic networking is how to connect from PodA to PodB.\nWe would get two situation:</p>\n<ol>\n<li>two <strong>Pod</strong> at the same <strong>Node</strong></li>\n<li>two <strong>Pod</strong> at the different <strong>Node</strong></li>\n</ol>\n<blockquote>\n<p><strong>Node</strong> can is a VM or machine which owned by kubernetes cluster.</p>\n</blockquote>\n<p>In the following discussion we are all based on <a href=\"https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#kubenet\">Kubenet</a>\nthis implementation. <strong>Kubelet</strong> would need to set <code class=\"language-text\">--network-plugin=kubenet</code>.</p>\n<h4>3.1 Pods at the same Node</h4>\n<p>In this case, it just as the first section, Pods would connect to the same bridge, in case called: <code class=\"language-text\">cbr0</code>.</p>\n<blockquote>\n<p>Kubenet creates a Linux bridge named <code class=\"language-text\">cbr0</code> and creates a veth pair for each pod with the host end of each pair connected to <code class=\"language-text\">cbr0</code>.</p>\n</blockquote>\n<p>Since we already talk about this way, we don't spend more time at here, the interesting part is,\nhow to allow Pods on</p>\n<h5>Figure 3.1 two pods at the same node</h5>\n<p><img src=\"/static/pod_to_pod_at_the_same_node-4a4fc63a9d14ce7f94079e396abc226c.svg\"></p>\n<h4>3.2 Pods at the different Node</h4>\n<p>When container networking have to work with other host of container, the problem would show.\nAt the tranditional environment we do not care the cluster consist of serveral host of container.\nIn old networking model we thought any container have to connect to outside world must using a host port to do that.\nBut in cluster world, port is a limited resource which would cause we can't scale the cluster well!\nThat's why we have <a href=\"https://github.com/docker/libnetwork/blob/master/docs/design.md\">CNM</a> and <a href=\"https://github.com/containernetworking/cni/blob/master/SPEC.md\">CNI</a> these models.\nWe aren't going to discuss their detail, but mention the possible approach of real world networking topology.</p>\n<p>Two <strong>Pod</strong> at the different <strong>Node</strong> won't be able to using the same bridge, which means we can't directly let packet pass through between them.</p>\n<h5>Figure 3.2 concept of nodes</h5>\n<p><img src=\"/static/concept_of_nodes-f508bc4ba5c6ebb0f7c921a30de61d5a.svg\"></p>\n<p>The whole packet flow would like:</p>\n<ol>\n<li>PodA send ARP</li>\n<li>ARP will fail, then Bridge <code class=\"language-text\">cbr0</code> would send the packet out the default route: <code class=\"language-text\">eth0</code> of host</li>\n<li>routing send the packet to <strong>default gateway</strong></li>\n<li><strong>default gateway</strong> send packet to correct host via CIDR, e.g. <code class=\"language-text\">10.0.2.101</code> to <code class=\"language-text\">10.10.0.3</code></li>\n<li>the VM owned PodB CIDR would judge this packet should send to itself <code class=\"language-text\">cbr0</code></li>\n<li><code class=\"language-text\">cbr0</code> send the packet to PodB finally</li>\n</ol>\n<h5>Firgure 3.3 CIDR nodes with default gateway</h5>\n<p><img src=\"/static/pod_to_pod_at_different_node_via_default_gateway-60f5dd234375d4ce27b71baa11dd519e.svg\"></p>\n<h3>4 Pod to Service</h3>\n<p>We show how to route traffic between <strong>Pods</strong> and their IP addresses. The model works good until we have to scale the <strong>Pod</strong>. To make <strong>Kubernetes</strong> be a great system, we need to have the ability to add/delete resource automatically, which is the main feature of <strong>Kubernetes</strong>, now problem comes, because we could remove the <strong>Pod</strong>, we couldn't trust it's IP, since the new <strong>Pod</strong> won't get the same IP mostly.</p>\n<p>To solve the problem, <strong>Kubernetes</strong> provide an abstraction called <strong>Service</strong>. A <strong>Service</strong> would be a group of selector and a group of port mapping with a cluster IP, which means it would select <strong>Pods</strong> as it's backend by selector and to loadbalancing for them and forward packets by port mappings. So whatever how <strong>Pods</strong> been created or deleted, <strong>Service</strong> would find those <strong>Pods</strong> with labels matched selectors, and we only have to know the IP of <strong>Service</strong> than know all IPs of <strong>Pods</strong>.</p>\n<p>Now, let's take a look at how it works.</p>\n<h4>4.1 iptables and netfilter</h4>\n<p><strong>Kubernetes</strong> relies on <code class=\"language-text\">netfilter</code> -- the networking framework bulit-in to <strong>Linux</strong>.</p>\n<p>To get more info about <code class=\"language-text\">netfilter</code> please take a look at:</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Netfilter\">wiki: netfilter</a></li>\n<li><a href=\"https://www.netfilter.org/\">netfilter project</a></li>\n</ul>\n<p><code class=\"language-text\">iptables</code> is one of userspace tools based on the <code class=\"language-text\">netfilter</code> providing a table-based system for defining rules for manipulating and transforming packets. In <strong>Kubernetes</strong>, <code class=\"language-text\">kube-proxy</code> controller would config <code class=\"language-text\">iptables</code> rules by watching the changes from API server. The rule monitoring the traffic to the cluster IP of <strong>Service</strong> and picking a IP from IPs of <strong>Pods</strong> then forwarding the traffic to the picked IP by updating the destination IP from the cluster IP to the picked IP. This rule would be updated by cluster IP changed, <strong>Pod</strong> ADDED, <strong>Pod</strong> DELETED. Which means loadbalancing already been done on the machine to take traffic directed to cluster IP to an actual IP of <strong>Pod</strong>.</p>\n<h5>Figure 4.1 Pod to Service topology</h5>\n<p><img src=\"/static/pod_to_service-ddedbdf84b8f048c436867fcb77fe7ce.svg\"></p>\n<p>After the destination IP be updated, the networking model would fall back to the <strong>Pod to Pod</strong> model.</p>\n<p>You can get more details of <code class=\"language-text\">iptables</code> via:</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Iptables\">wiki: iptables</a></li>\n<li><a href=\"https://linux.die.net/man/8/iptables\">man: iptables</a></li>\n</ul>\n<h4>4.2 loadbalancing</h4>\n<p>Now I would create some <code class=\"language-text\">iptables</code> rules to mock a <strong>Service</strong> for static IPs. Assuming we have three IPs are: <code class=\"language-text\">10.244.1.2</code>, <code class=\"language-text\">10.244.1.3</code>, <code class=\"language-text\">10.244.1.4</code> and a cluster IP: <code class=\"language-text\">10.0.0.2</code></p>\n<h5>Add one IP after the cluster IP</h5>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ iptables <span class=\"token punctuation\">\\</span>\n  -t nat <span class=\"token comment\"># nat table</span>\n  -A PREROUTING <span class=\"token comment\"># Append to PREROUTING chain</span>\n  -p tcp <span class=\"token comment\"># protocol TCP</span>\n  -d <span class=\"token number\">10.0</span>.0.2 <span class=\"token comment\"># only for the packet to 10.0.0.2</span>\n  --dport <span class=\"token number\">80</span> <span class=\"token comment\"># only for port 80</span>\n  -j DNAT <span class=\"token comment\"># DNAT target</span>\n  --to-destination <span class=\"token number\">10.244</span>.1.2:8080 <span class=\"token comment\"># change destination to 10.244.1.2:8080</span></code></pre></div>\n<p>Unfortunately, we can't just apply this command on to each IPs we want to loadbalance, because the first rule would take all the jobs from others(but our work won't be, damn). That's why <code class=\"language-text\">iptables</code> provides a module called <code class=\"language-text\">statistic</code> can work with two different modes:</p>\n<ul>\n<li><code class=\"language-text\">random</code>: probability</li>\n<li><code class=\"language-text\">nth</code>: round robin algorithm</li>\n</ul>\n<blockquote>\n<p>Note: loadbalancing only works during the connection phase of the TCP protocol. Once the connection has been established, the connection would be routed to the same server.</p>\n</blockquote>\n<p>We only introduce round robin here, since it's quite easy to understand and we want to talk about loadbalancing than how loadbalancing works.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CLUSTER_IP</span><span class=\"token operator\">=</span><span class=\"token number\">10.0</span>.0.2\n$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">SERVICE_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">80</span>\n$ iptables <span class=\"token punctuation\">\\</span>\n  -A PREROUTING <span class=\"token punctuation\">\\</span>\n  -p tcp <span class=\"token punctuation\">\\</span>\n  -t nat -d <span class=\"token variable\">$CLUSTER_IP</span> <span class=\"token punctuation\">\\</span>\n  --dport <span class=\"token variable\">$SERVICE_PORT</span> <span class=\"token punctuation\">\\</span>\n  -m statistic --mode nth <span class=\"token punctuation\">\\</span>\n  --every <span class=\"token number\">3</span> --packet <span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span>\n  -j DNAT <span class=\"token punctuation\">\\</span>\n  --to-destination <span class=\"token number\">10.244</span>.1.2:8080\n\n$ iptables <span class=\"token punctuation\">\\</span>\n  -A PREROUTING <span class=\"token punctuation\">\\</span>\n  -p tcp <span class=\"token punctuation\">\\</span>\n  -t nat -d <span class=\"token variable\">$CLUSTER_IP</span> <span class=\"token punctuation\">\\</span>\n  --dport <span class=\"token variable\">$SERVICE_PORT</span> <span class=\"token punctuation\">\\</span>\n  -m statistic --mode nth <span class=\"token punctuation\">\\</span>\n  --every <span class=\"token number\">2</span> --packet <span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span>\n  -j DNAT <span class=\"token punctuation\">\\</span>\n  --to-destination <span class=\"token number\">10.244</span>.1.3:8080\n\n$ iptables <span class=\"token punctuation\">\\</span>\n  -A PREROUTING <span class=\"token punctuation\">\\</span>\n  -p tcp <span class=\"token punctuation\">\\</span>\n  -t nat -d <span class=\"token variable\">$CLUSTER_IP</span> <span class=\"token punctuation\">\\</span>\n  --dport <span class=\"token variable\">$SERVICE_PORT</span> <span class=\"token punctuation\">\\</span>\n  -j DNAT <span class=\"token punctuation\">\\</span>\n  --to-destination <span class=\"token number\">10.244</span>.1.4:8080</code></pre></div>\n<p>Now we would have a problem, we send the packet to cluster IP to the <strong>Pod</strong> directly, but since the source IP is the client <strong>Pod</strong> IP, target <strong>Pod</strong> would send reply back to the client <strong>Pod</strong> would wrong source IP(not cluster IP). Let's simplify these words:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># request send\npodA -&gt; clusterIP\n# After iptables\npodA -&gt; podB\n# reply send\npodB -&gt; podA</code></pre></div>\n<p>We can find that connection would be dropped because the destination IP is not what <code class=\"language-text\">podA</code> expected!</p>\n<p>So we also have to change the source IP for reply packet:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ iptables <span class=\"token punctuation\">\\</span>\n  -t nat <span class=\"token punctuation\">\\</span>\n  -A POSTROUTING <span class=\"token punctuation\">\\</span>\n  -p tcp <span class=\"token punctuation\">\\</span>\n  -s <span class=\"token number\">10.244</span>.1.2 <span class=\"token punctuation\">\\</span>\n  --sport <span class=\"token number\">8080</span> <span class=\"token punctuation\">\\</span>\n  -j SNAT <span class=\"token punctuation\">\\</span>\n  --to-source <span class=\"token number\">10.0</span>.0.2:80</code></pre></div>\n<p>Now you finally get a complete connection.</p>\n<p>To get more info about loadbalacing &#x26; NAT(network address translation):</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Network_address_translation#DNAT\">wiki: DNAT</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Network_address_translation#SNAT\">wiki: SNAT</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Round-robin_scheduling\">wiki: round robin</a></li>\n</ul>\n<h3>5 Internet to Service</h3>\n<h4>5.1 Egress</h4>\n<p>Egress is the traffic from Pod to internet, consider a packet from Pod to any external service.\ne.g. <code class=\"language-text\">10.244.1.10 -&gt; 8.8.8.8</code></p>\n<p>However, the thing is not so easy since that <code class=\"language-text\">8.8.8.8</code> has no idea who is <code class=\"language-text\">10.244.1.10</code>, because they are not in the same network. So anyway we would need a global IP, it calls masquerading. Now assuming we have an IP <code class=\"language-text\">219.140.7.218</code>, our target is changing <code class=\"language-text\">10.244.1.10</code> to <code class=\"language-text\">219.140.7.218</code> before it reach <code class=\"language-text\">8.8.8.8</code>. And then when <code class=\"language-text\">8.8.8.8</code> send reply packets, we would change <code class=\"language-text\">219.140.7.218</code> to <code class=\"language-text\">10.244.1.10</code> to complete the whole connection.</p>\n<p>But we have another problem here, what if we have several Pods such outgoing request? How to know which Pod should get the reply packet? A simple way(not going to introduce all NAT way) is allocate a port to each connection, so every Pod outgoing request would get a port, for example: <code class=\"language-text\">10.244.1.10:8080 -&gt; 8.8.8.8:53</code> would be rewrote as <code class=\"language-text\">219.140.7.218:61234</code>, so <code class=\"language-text\">8.8.8.8</code> would send reply to <code class=\"language-text\">219.140.7.218:61234</code>. If at the same time <code class=\"language-text\">10.244.1.11:8080 -&gt; 8.8.8.8:53</code> rewrite as <code class=\"language-text\">219.140.7.218:61235 -&gt; 8.8.8.8:53</code> got reply packet, the packet would send to <code class=\"language-text\">61235</code>, so we can rewrite the packet correct back to <code class=\"language-text\">10.244.1.10</code> and <code class=\"language-text\">10.244.1.11</code>.</p>\n<h4>5.2 Ingress</h4>\n<h5>5.2.1 Load balancer</h5>\n<p>Load balancer is quite easy to understand since it just provide an IP for your service, and do totally the same thing as internal service IP rewritting then send to correct Pod.</p>\n<h5>5.2.2 Ingress controller</h5>\n<p>Ingress controller is an application layer load balancer.</p>\n<p>Example(see <a href=\"https://github.com/dannypsnl/k8s-test-deploys/tree/master/ingress\">https://github.com/dannypsnl/k8s-test-deploys/tree/master/ingress</a> to get full example):</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> extensions/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hello<span class=\"token punctuation\">-</span>world<span class=\"token punctuation\">-</span>ingress\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kubernetes.io/ingress.class</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/ssl-redirect</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/rewrite-target</span><span class=\"token punctuation\">:</span> /\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /hello\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> hello<span class=\"token punctuation\">-</span>svc\n              <span class=\"token key atrule\">servicePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /world\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> world<span class=\"token punctuation\">-</span>svc\n              <span class=\"token key atrule\">servicePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p>See example yaml can find that we define <code class=\"language-text\">http.path</code>: <code class=\"language-text\">/hello</code> and <code class=\"language-text\">/world</code>, basically ingress controller would handle the root path <code class=\"language-text\">/</code> of http request, and send packet to <strong>hello-svc</strong> when path has prefix <code class=\"language-text\">/hello</code>, and send packet to <strong>world-svc</strong> when path has prefix <code class=\"language-text\">/world</code>(ideally, ingress-nginx do pod selection inside of their code, at least v0.20.0 still acting like that).</p>","frontmatter":{"title":"Kubernetes Networking: concept and overview from underlying perspective","categories":["cs"],"tags":["networking","kubernetes","linux"]}},"allMarkdownRemark":{"edges":[{"node":{"id":"546863be-ba1c-595e-8370-eb774f31f60c","frontmatter":{"title":"lexer ","categories":["cs"],"tags":["compiler","lexer","golang"]},"fields":{"slug":"/blog/2017/07/08/cs/lexer-explains/"}}},{"node":{"id":"5072ada0-29d8-500b-8371-f80533ab27b0","frontmatter":{"title":"Vim replace","categories":["cs"],"tags":["vim"]},"fields":{"slug":"/blog/2017/10/24/cs/vim-replace/"}}},{"node":{"id":"28754ab9-bc87-5304-83d9-11586ee70fce","frontmatter":{"title":"C++ thread ","categories":["cs"],"tags":["cpp","thread"]},"fields":{"slug":"/blog/2017/06/26/cs/cpp-thread-basic/"}}},{"node":{"id":"d191956f-b5bb-5c3f-993a-eacec934f193","frontmatter":{"title":"llvm Go bindings","categories":["cs"],"tags":["llvm","golang"]},"fields":{"slug":"/blog/2017/12/04/cs/llvm-go-bindings/"}}},{"node":{"id":"e34022aa-be3f-504a-9cc9-b222c3b6e52b","frontmatter":{"title":"Type driven development in C++","categories":["cs"],"tags":["cpp"]},"fields":{"slug":"/blog/2017/12/23/cs/type-driven-development-in-cpp/"}}},{"node":{"id":"6cf1b36b-fed7-5566-84f6-64f596c0568f","frontmatter":{"title":"OpenCV introduction","categories":["cs"],"tags":["OpenCV","cpp"]},"fields":{"slug":"/blog/2018/02/08/cs/opencv-introduction/"}}},{"node":{"id":"e507df39-a49c-5c75-a4c4-507de675ce52","frontmatter":{"title":"ANTLR v4--introduction","categories":["cs"],"tags":["antlr4"]},"fields":{"slug":"/blog/2017/09/03/cs/introduction-of-antlr4/"}}},{"node":{"id":"08473604-caaf-538c-a9ac-633842a5eb3a","frontmatter":{"title":"You should know about `this`","categories":["cs"],"tags":["javascript"]},"fields":{"slug":"/blog/2018/02/09/cs/you-should-know-about-this/"}}},{"node":{"id":"fd161ad4-402d-58bd-8190-08e44075694a","frontmatter":{"title":"Erlang Quick Start","categories":["cs"],"tags":["erlang"]},"fields":{"slug":"/blog/2018/01/05/cs/erlang-quick-start/"}}},{"node":{"id":"a379d931-4a5a-50cf-b87a-29c36bf0bfca","frontmatter":{"title":"Sort by interface in Go","categories":["cs"],"tags":["golang"]},"fields":{"slug":"/blog/2018/02/14/cs/sort-by-interface-in-go/"}}},{"node":{"id":"44c9e7e4-a19a-5f18-98f6-b6105e3ceb1c","frontmatter":{"title":"The best practice of Singleton in Golang","categories":["cs"],"tags":["golang","DesignPattern"]},"fields":{"slug":"/blog/2018/02/12/cs/singleton-best-practice-in-golang/"}}},{"node":{"id":"843f70c9-b9bc-52c0-920f-8ebec90635fe","frontmatter":{"title":"Create a WaitGroup by yourself","categories":["cs"],"tags":["golang","concurrency"]},"fields":{"slug":"/blog/2018/02/15/cs/create-a-wait-group-by-yourself-and-do-not-use-it/"}}},{"node":{"id":"c16962e8-fa69-54e8-bb2b-c781a2eabd46","frontmatter":{"title":"Nginx ","categories":["cs"],"tags":["nginx","web"]},"fields":{"slug":"/blog/2018/04/02/cs/nginx-run-and-up/"}}},{"node":{"id":"49fd1e2e-1554-5d24-ae01-66e647e77df8","frontmatter":{"title":"Phoneix ","categories":["cs"],"tags":["phoenix","elixir","web"]},"fields":{"slug":"/blog/2018/03/31/cs/phoenix-run-and-up/"}}},{"node":{"id":"b22b2e98-3a62-5e3a-b698-5b6521ea8c3f","frontmatter":{"title":"Introduction Of Char Recognizing -- Lexer Tech","categories":["cs"],"tags":["compiler","lexer","rust"]},"fields":{"slug":"/blog/2018/02/25/cs/introduction-of-char-recognizing-lexer-tech/"}}},{"node":{"id":"7aadac41-a6ef-595c-adb3-fe7349045f54","frontmatter":{"title":"How to disable Go test caching","categories":["cs"],"tags":["golang"]},"fields":{"slug":"/blog/2018/03/17/cs/how-to-disable-go-test-caching/"}}},{"node":{"id":"5d5d1de0-f7e4-50de-a930-599e3cd895b3","frontmatter":{"title":"Some thinking from Elixir X Ruby Conf","categories":["cs"],"tags":["elixir"]},"fields":{"slug":"/blog/2018/05/01/cs/elixir-ruby-conf-2018-thinking/"}}},{"node":{"id":"c1666f78-5ad1-5fcc-9142-1f14a81b6079","frontmatter":{"title":"Go Channels ","categories":["cs"],"tags":["golang","concurrency"]},"fields":{"slug":"/blog/2018/04/23/cs/go-channel-introduction/"}}},{"node":{"id":"c8c71a5e-7c2f-5503-b2f1-ac0620db1157","frontmatter":{"title":"Design of Redux-go v2","categories":["cs"],"tags":["golang","redux"]},"fields":{"slug":"/blog/2018/05/17/cs/design-of-redux-go-v2/"}}},{"node":{"id":"67df5cf3-7b75-52a0-bf1b-0e9a81cb0cb0","frontmatter":{"title":"How to getting start with Rust","categories":["cs"],"tags":["rust"]},"fields":{"slug":"/blog/2018/05/26/cs/getting-start-with-rust/"}}},{"node":{"id":"765d1f5a-a9e2-5773-b81d-6fa2a465e86b","frontmatter":{"title":"Error is Value","categories":["cs"],"tags":["golang","errors"]},"fields":{"slug":"/blog/2018/06/22/cs/error-is-value/"}}},{"node":{"id":"ec13d746-3be7-5ec5-8cc2-9f5773c784ee","frontmatter":{"title":"Practical issue about DNS -- EDNS0","categories":["cs"],"tags":["networking","dns","golang"]},"fields":{"slug":"/blog/2018/08/07/cs/practical-issue-about-dns-edns0/"}}},{"node":{"id":"d6e6b1cc-7b50-59af-b3dd-1e2d1bd5fb5e","frontmatter":{"title":"Reflection in Go: create a stack[T]","categories":["cs"],"tags":["golang","reflection"]},"fields":{"slug":"/blog/2018/07/22/cs/reflection-in-go-create-a-stack-t/"}}},{"node":{"id":"a82969d9-e24d-5361-8fdf-797bd2415044","frontmatter":{"title":"gRPC quick start in Go","categories":["cs"],"tags":["networking","gRPC","golang"]},"fields":{"slug":"/blog/2018/08/16/cs/gRPC-basic-tutorial/"}}},{"node":{"id":"03ff243a-28ff-5c17-93bc-5acbf8aa87df","frontmatter":{"title":"Mark Sweep GC","categories":["cs"],"tags":["gc"]},"fields":{"slug":"/blog/2018/09/03/cs/mark-sweep/"}}},{"node":{"id":"b2e1114a-0574-582d-801f-ea4a99e96feb","frontmatter":{"title":"Use httpexpect to test server","categories":["cs"],"tags":["http","testing","networking","golang"]},"fields":{"slug":"/blog/2018/09/16/cs/httpexpect-go/"}}},{"node":{"id":"30f863fb-545c-5fdf-8fbe-bf908eb73753","frontmatter":{"title":"Go quick start","categories":["cs"],"tags":["golang"]},"fields":{"slug":"/blog/2018/09/23/cs/golang-quick-start/"}}},{"node":{"id":"292b53ea-c5a7-551b-8607-b920c50d4c6e","frontmatter":{"title":"Test LLVM Go binding in travis","categories":["cs"],"tags":["llvm","golang","testing","travis"]},"fields":{"slug":"/blog/2018/10/06/cs/test-llvm-go-binding-in-travis/"}}},{"node":{"id":"948da191-2170-532c-9e7a-61104f546f7a","frontmatter":{"title":"Testing in Go","categories":["cs"],"tags":["golang","testing","debug"]},"fields":{"slug":"/blog/2018/11/17/cs/testing-in-go/"}}},{"node":{"id":"9fd83d10-85ca-5ed3-9416-599e3d54d4c6","frontmatter":{"title":"Kubernetes  Pod ","categories":["cs"],"tags":["kubernetes"]},"fields":{"slug":"/blog/2018/10/27/cs/kubernetes-start-from-pod/"}}},{"node":{"id":"2d6b2494-ee64-5f20-a82a-f73f14882cee","frontmatter":{"title":"fun networking: tcp close","categories":["cs"],"tags":["workrecord","networking","tcp"]},"fields":{"slug":"/blog/2018/11/30/cs/fun-network-tcp-close/"}}},{"node":{"id":"b69e04f4-45ce-5dff-9a51-3fd54d7f2136","frontmatter":{"title":"XDP some note","categories":["cs"],"tags":["networking","xdp"]},"fields":{"slug":"/blog/2018/11/30/cs/xdp-some-note/"}}},{"node":{"id":"092c8346-aeb9-5615-9d86-7d331ef2cace","frontmatter":{"title":"Kubernetes context","categories":["cs"],"tags":["kubernetes"]},"fields":{"slug":"/blog/2018/12/09/cs/kubernetes-context/"}}},{"node":{"id":"8de033ca-f3ad-5b21-b998-6f31085d5c9e","frontmatter":{"title":"Should I learn?","categories":["cs"],"tags":["career","life"]},"fields":{"slug":"/blog/2018/12/22/cs/should-i-learn/"}}},{"node":{"id":"cee81faa-22ef-5571-8540-e84fbfd9f710","frontmatter":{"title":"How to compare Go benchmark in TravisCI","categories":["cs"],"tags":["golang","testing","travis"]},"fields":{"slug":"/blog/2018/12/28/cs/golang-benchmark-compare/"}}},{"node":{"id":"0644a550-53f6-545c-9659-35a85d899494","frontmatter":{"title":"Introduction of LLDB","categories":["cs"],"tags":["tool","debugger","lldb"]},"fields":{"slug":"/blog/2019/03/17/cs/introduction-of-lldb/"}}},{"node":{"id":"05bd5f1b-bc76-5625-a764-e0d3c71b402f","frontmatter":{"title":"Make googletest-like test framework from scratch","categories":["cs"],"tags":["metaprogramming","cpp"]},"fields":{"slug":"/blog/2019/03/03/cs/make-googletest-like-test-framework-from-scratch/"}}},{"node":{"id":"7755f76a-3458-5764-9f50-68c4ffb0a6c9","frontmatter":{"title":"gRPC proxy: approach & pain","categories":["cs"],"tags":["gRPC"]},"fields":{"slug":"/blog/2019/04/13/cs/grpc-proxy-approach-and-pain/"}}},{"node":{"id":"9a3c9420-dd65-579b-bbe6-04cdd5654b91","frontmatter":{"title":"Write a hashmap in Go","categories":["cs"],"tags":["data-structure","golang"]},"fields":{"slug":"/blog/2019/04/04/cs/write-hashmap-in-go/"}}},{"node":{"id":"f1b55b8d-f933-5627-8717-d62ef5dbe2f8","frontmatter":{"title":"10.9...()","categories":["math"],"tags":["dedekind","dedekind cut"]},"fields":{"slug":"/blog/2019/03/01/math/dedekind-cut-and-application/"}}},{"node":{"id":"fd5f04d7-405c-5e7d-8ab6-3ccdc0bce760","frontmatter":{"title":"HugePages on Kubernetes","categories":["cs"],"tags":["workrecord","hugepages","kubernetes","linux"]},"fields":{"slug":"/blog/2019/05/04/cs/hugepages-on-kubernetes/"}}},{"node":{"id":"58d36ae9-d194-5fac-bc24-d0c9730866bf","frontmatter":{"title":"5 tools for file transfer","categories":["cs"],"tags":["tool"]},"fields":{"slug":"/blog/2019/04/27/cs/five-tools-for-file-transfer/"}}},{"node":{"id":"49d97e32-8a97-5e60-8c30-c78c403bba0d","frontmatter":{"title":"tcpdump cheat sheet","categories":["cs"],"tags":["tcpdump","networking"]},"fields":{"slug":"/blog/2019/06/25/cs/tcpdump-cheat-sheet/"}}},{"node":{"id":"9c683f4e-7281-5153-a08a-a50b6ee05b88","frontmatter":{"title":"The Go concurrency bug I made","categories":["cs"],"tags":["golang","concurrency","workrecord"]},"fields":{"slug":"/blog/2019/05/25/cs/golang-concurrency-bug-i-made/"}}},{"node":{"id":"a74742e1-23ff-5977-bdfc-5f74842b234c","frontmatter":{"title":"A simple way to ensure interface won't be implemented accidently","categories":["cs"],"tags":["golang"]},"fields":{"slug":"/blog/2019/06/18/cs/simple-way-to-ensure-go-interface-wont-be-implement-accidently/"}}},{"node":{"id":"bbf87cca-106e-5d96-a27d-a4f68a7cf012","frontmatter":{"title":"How trait with lifetime can be a trouble and how to fix it","categories":["cs"],"tags":["rust","rust lifetime"]},"fields":{"slug":"/blog/2019/07/31/cs/how-lifetime-trait-can-be-trouble-and-how-to-fix-it/"}}},{"node":{"id":"739889c2-58d8-5632-9bc4-1518751e52a6","frontmatter":{"title":"Notes: Ruby Conf Taiwan 2019","categories":["cs"],"tags":["language","gc"]},"fields":{"slug":"/blog/2019/08/13/cs/ruby-conf-taiwan-2019/"}}},{"node":{"id":"4e62b250-d25f-5c39-bd18-2d5b3514461b","frontmatter":{"title":"cgo can be a trouble","categories":["cs"],"tags":["golang","cgo"]},"fields":{"slug":"/blog/2019/08/15/cs/cgo-can-be-a-trouble/"}}},{"node":{"id":"10eb1882-d25b-532e-90b3-ba31c0ae4de0","frontmatter":{"title":"nix report","categories":["cs"],"tags":["nix","shell"]},"fields":{"slug":"/blog/2019/09/12/cs/nix-report/"}}},{"node":{"id":"778b403e-0913-55b6-8631-8f709c3190a4","frontmatter":{"title":"DPDK -- EAL Input/output error","categories":["cs"],"tags":["dpdk","networking","workrecord"]},"fields":{"slug":"/blog/2019/10/18/cs/dpdk-input-output-error/"}}},{"node":{"id":"c21bfb9e-3ed2-5312-8652-c28945f78f52","frontmatter":{"title":"Why not a big script","categories":["cs"],"tags":["shell"]},"fields":{"slug":"/blog/2019/10/05/cs/why-not-big-script/"}}},{"node":{"id":"af72f2b3-cd09-547a-bce0-9cfef54189d7","frontmatter":{"title":"DPDK usertools: devbind","categories":["cs"],"tags":["dpdk","networking","workrecord"]},"fields":{"slug":"/blog/2019/10/19/cs/dpdk-usertools-devbind/"}}},{"node":{"id":"ad56e808-8f85-55ad-9aa7-34f5336e6d4a","frontmatter":{"title":"Privileged Pod -- Debug kubernetes node","categories":["cs"],"tags":["kubernetes","debug"]},"fields":{"slug":"/blog/2019/09/01/cs/privileged-pod/"}}},{"node":{"id":"d1844995-f98a-582d-8034-1261c2538134","frontmatter":{"title":"How to use .gitignore","categories":["cs"],"tags":["git"]},"fields":{"slug":"/blog/2019/11/08/cs/how-to-use-gitignore/"}}},{"node":{"id":"55cd1966-fe9a-5d8e-a7bc-613b82ea53cc","frontmatter":{"title":"Weird behavior in Go: encoding/gob","categories":["cs"],"tags":["gob","golang","workrecord"]},"fields":{"slug":"/blog/2019/10/31/cs/weird-behavior-gob/"}}},{"node":{"id":"e7effcba-43fa-55a2-a9a4-3ae56227bb4d","frontmatter":{"title":"Reflection on Working effectively with legacy code --- Part I","categories":["cs"],"tags":["programming","testing"]},"fields":{"slug":"/blog/2019/11/24/cs/reflection-on-working-effectively-with-legacy-code-part-one/"}}},{"node":{"id":"9f3948b2-bb63-5a4f-9c9c-0a1fadfc3517","frontmatter":{"title":"Mergeable replicated data types","categories":["cs"],"tags":["paper","data-structure"]},"fields":{"slug":"/blog/2019/11/30/cs/mergeable-replicated-data-types/"}}},{"node":{"id":"95cd04e7-3518-5f09-bc15-b481e5502ab8","frontmatter":{"title":"Algebra data type vs Class","categories":["cs"],"tags":["plt","scala","haskell"]},"fields":{"slug":"/blog/2019/11/19/cs/algebra-data-type-vs-class/"}}},{"node":{"id":"f12f1f8a-6de2-51da-8f8a-d323a92b3549","frontmatter":{"title":"Infinite Type","categories":["cs"],"tags":["plt","language"]},"fields":{"slug":"/blog/2019/12/08/cs/infinite-type/"}}},{"node":{"id":"5e569bcc-7ad2-5200-921e-a0ce3b17a773","frontmatter":{"title":"NOTE: If we write kubernetes client in Rust","categories":["cs"],"tags":["note","programming","kubernetes","rust"]},"fields":{"slug":"/blog/2019/12/13/cs/if-write-kube-client-go-in-rust/"}}},{"node":{"id":"a2137fb4-59cf-577d-b07f-a829d4f6882c","frontmatter":{"title":"How to test in Haskell: HSpec setup","categories":["cs"],"tags":["haskell","beginner","testing"]},"fields":{"slug":"/blog/2019/12/14/cs/how-to-test-haskell/"}}},{"node":{"id":"785de266-a84d-57e3-b119-46a5f7e0114a","frontmatter":{"title":"NOTE: get labels from Pod","categories":["cs"],"tags":["note","kubernetes"]},"fields":{"slug":"/blog/2019/12/20/cs/note-get-labels-from-pod/"}}},{"node":{"id":"de3bd99a-2f0c-5473-a853-21523d01dbb5","frontmatter":{"title":"Reflection on Working effectively with legacy code --- chapter 20 to 23","categories":["cs"],"tags":["programming","testing"]},"fields":{"slug":"/blog/2020/01/04/cs/reflection-on-working-effectively-with-legacy-code-ch-20-23/"}}},{"node":{"id":"d74e85e7-1028-51d0-add9-0c0ea37c4cb6","frontmatter":{"title":"TDD is not silver bullet","categories":["cs"],"tags":["programming"]},"fields":{"slug":"/blog/2020/01/11/cs/tdd-is-not-silver-bullet/"}}},{"node":{"id":"d4e2efd2-4da2-54dd-9e46-544abf0f1953","frontmatter":{"title":"NOTE: What is lambda calculus","categories":["cs"],"tags":["note","plt","utlc"]},"fields":{"slug":"/blog/2020/01/01/cs/note-what-is-lambda-calculus/"}}},{"node":{"id":"44eb6dda-c3e9-54fb-a251-b415fb08b49f","frontmatter":{"title":"NOTE: a little bit Z3 solver","categories":["cs"],"tags":["note","smt","z3"]},"fields":{"slug":"/blog/2020/01/24/cs/note-a-little-bit-z3-solver/"}}},{"node":{"id":"2a3dbf6d-50c5-5b0e-b4c2-4890cfc650a0","frontmatter":{"title":"NOTE: C++ optional","categories":["cs"],"tags":["note","cpp","language"]},"fields":{"slug":"/blog/2020/01/26/cs/note-cpp-optional/"}}},{"node":{"id":"f4cd1802-ad9e-5d80-81f0-79f85515f2cd","frontmatter":{"title":"NOTE: bounded polymorphism","categories":["cs"],"tags":["note","plt","language","haskell"]},"fields":{"slug":"/blog/2020/01/24/cs/note-bound-polymorphism/"}}},{"node":{"id":"e5f1b03a-f5cd-5b9b-aa1f-499ea2076fac","frontmatter":{"title":"","categories":["cs"],"tags":["language"]},"fields":{"slug":"/blog/2020/02/06/cs/suggested-languages/"}}},{"node":{"id":"ec5fd544-7096-5098-89a6-0f06a873d47e","frontmatter":{"title":" Gogoro ","categories":["funny"],"tags":["life"]},"fields":{"slug":"/blog/2020/01/31/funny/two-idiots-who-cant-ride-gogoro/"}}},{"node":{"id":"10e9c6f2-3474-5ebc-99d2-5c4a97f879ea","frontmatter":{"title":"Binary Encoding of Integer","categories":["cs"],"tags":["fundamental"]},"fields":{"slug":"/blog/2020/03/21/cs/binary-encoding-of-interger/"}}},{"node":{"id":"e2302e39-eea1-5df3-90a6-ef060120cf9e","frontmatter":{"title":"","categories":["book"],"tags":["novel","recommend","skyward","Brandon Sanderson"]},"fields":{"slug":"/blog/2020/04/01/book/recommend-novel-skyward/"}}},{"node":{"id":"80d44a1a-1a60-5d93-bf71-d21cbe6d796c","frontmatter":{"title":"NOTE: class member initialization order in C++","categories":["cs"],"tags":["note","cpp","class member","initialization","language"]},"fields":{"slug":"/blog/2020/04/13/cs/note-cpp-member-initialize-order/"}}},{"node":{"id":"ed391a8d-358b-56e3-b55c-f0fd90492aa8","frontmatter":{"title":"NOTE: Seven Bridges of Knigsberg and Eulerian graph","categories":["math"],"tags":["note","topology","graph","Eulerian path","Eulerian circuit"]},"fields":{"slug":"/blog/2020/04/03/math/note-seven-bridges-of-konigsberg-eulerian-path/"}}},{"node":{"id":"047ac64e-b55c-5043-adae-1d5c9321c5cd","frontmatter":{"title":"NOTE: how to install Nix package manager on MacOS Catalina","categories":["cs"],"tags":["note","nix","macos","catalina"]},"fields":{"slug":"/blog/2020/04/17/cs/note-how-to-install-nix-on-macos-catalina/"}}},{"node":{"id":"c6c52b5a-8170-508f-b887-6b1ce2f6ecda","frontmatter":{"title":"How to parse expression with the parser combinator","categories":["cs"],"tags":["compiler","parser","racket"]},"fields":{"slug":"/blog/2020/05/03/cs/how-to-parse-expression-with-parser-combinator/"}}},{"node":{"id":"eff65ed1-fdb8-5069-919f-3983784e1344","frontmatter":{"title":"A beautiful proof: There have infinite primes","categories":["math"],"tags":["prime"]},"fields":{"slug":"/blog/2020/05/09/math/a-beautiful-proof-there-have-infinite-primes/"}}},{"node":{"id":"a30fc310-d412-5f36-95c3-0aee1ea000ae","frontmatter":{"title":"","categories":["recipe"],"tags":["spaghetti","white sauce"]},"fields":{"slug":"/blog/2020/05/10/recipe/spaghetti/"}}},{"node":{"id":"0ad29589-2261-5f8f-a0f6-0ef61d5a4833","frontmatter":{"title":"NOTE: ","categories":["cs"],"tags":["note","algorithm","time complexity"]},"fields":{"slug":"/blog/2020/05/12/cs/algorithm-time-complexity/"}}},{"node":{"id":"4bc528e2-46d3-5ff9-9ef6-cd2036d9d741","frontmatter":{"title":"NOTE: ","categories":["math"],"tags":["note","set theory","paradox","type theory"]},"fields":{"slug":"/blog/2020/05/31/math/set-theory-three-paradox/"}}},{"node":{"id":"67ccc98d-872a-548d-bec9-c1edd2297252","frontmatter":{"title":"Currying","categories":["cs"],"tags":["racket","macro"]},"fields":{"slug":"/blog/2020/05/31/cs/currying/"}}},{"node":{"id":"f49e05b7-906e-5dca-87d5-2a3d39e773db","frontmatter":{"title":"","categories":["recipe"],"tags":["okonomiyaki"]},"fields":{"slug":"/blog/2020/06/17/recipe/recipe-okonomiyaki/"}}},{"node":{"id":"b8aae0b8-d789-57eb-b671-75bfa2f4290d","frontmatter":{"title":"NOTE: ","categories":["cs"],"tags":["note","algorithm","order"]},"fields":{"slug":"/blog/2020/06/20/cs/algorithm-order/"}}},{"node":{"id":"c6c0c8c1-db91-54c9-8929-78658c2a90dd","frontmatter":{"title":"NOTE: lambda 2","categories":["cs"],"tags":["note","plt","lambda 2"]},"fields":{"slug":"/blog/2020/06/12/cs/second-order-typed-lambda-calculus/"}}},{"node":{"id":"203837be-04fc-567d-9450-33a3f6b02872","frontmatter":{"title":"NOTE: ZFC","categories":["math"],"tags":["note","set theory"]},"fields":{"slug":"/blog/2020/06/11/math/note-zfc/"}}},{"node":{"id":"8dce6fe3-902a-5b3d-9d14-2e302cf0bef5","frontmatter":{"title":"","categories":["book"],"tags":["novel","recommend","Quality Land"]},"fields":{"slug":"/blog/2020/07/03/book/recommend-novel-quality-land/"}}},{"node":{"id":"a3447c9d-20fc-58e9-a993-f25b1f2b0d8a","frontmatter":{"title":"Extension hack","categories":["cs"],"tags":["swift","extension"]},"fields":{"slug":"/blog/2017/09/29/cs/extension-hack/"}}},{"node":{"id":"3c3130a0-7b7a-5b3f-9f3c-9a23ed88cc72","frontmatter":{"title":"Swift --extension","categories":["cs"],"tags":["swift","extension"]},"fields":{"slug":"/blog/2017/09/29/cs/swift-extension/"}}},{"node":{"id":"13404fcc-084f-5f56-8938-c72eb8e96c94","frontmatter":{"title":"Tracing source code of Kubernetes client-go","categories":["cs"],"tags":["kubernetes","golang"]},"fields":{"slug":"/blog/2019/01/25/cs/kube-client-go-source-code-tracing/"}}},{"node":{"id":"24cddb21-779c-545e-aff0-dd840418c8d2","frontmatter":{"title":" Go","categories":["cs"],"tags":["golang","language"]},"fields":{"slug":"/blog/2020/01/19/cs/last-time-complain-about-go/"}}},{"node":{"id":"460001d0-2e11-586f-a331-e7294c963060","frontmatter":{"title":"A Racket macro tutorial -- get HTTP parameters easier","categories":["cs"],"tags":["racket","metaprogramming","macro"]},"fields":{"slug":"/blog/2020/02/16/cs/a-racket-macro-tutorial-get-http-parameters-easier/"}}},{"node":{"id":"d0e1e323-7ade-5a75-8c86-dbfd7f94861b","frontmatter":{"title":"Programming ","categories":["cs"],"tags":["career","life"]},"fields":{"slug":"/blog/2020/05/13/cs/programming-life-retro/"}}},{"node":{"id":"c029b0a3-b626-5758-b8e5-b6a38c781376","frontmatter":{"title":"Kubernetes Networking: concept and overview from underlying perspective","categories":["cs"],"tags":["networking","kubernetes","linux"]},"fields":{"slug":"/blog/2019/05/18/cs/kubernetes-networking-concept-and-overview/"}}},{"node":{"id":"bc080f44-1eaf-5efd-a61a-ff3f1da28b84","frontmatter":{"title":"From Functor to Applicative","categories":["cs"],"tags":["plt","applicative","language","haskell"]},"fields":{"slug":"/blog/2020/04/11/cs/from-functor-to-applicative/"}}},{"node":{"id":"757f6fbc-6d36-5b3f-989e-ef792d13aa7e","frontmatter":{"title":"NOTE: simply typed lambda calculus","categories":["cs"],"tags":["note","plt","stlc"]},"fields":{"slug":"/blog/2020/03/08/cs/note-stlc/"}}},{"node":{"id":"0bbd48f9-b7ac-5fbe-85f5-19ca3fa12734","frontmatter":{"title":"Type as Constraint: Why we need more type?","categories":["cs"],"tags":["plt","language"]},"fields":{"slug":"/blog/2020/01/16/cs/type-as-constraint-why-we-need-more-type/"}}},{"node":{"id":"2a45e9d5-898d-59d4-84d4-f96458edfd2e","frontmatter":{"title":"","categories":["cs"],"tags":["programming","beginner","racket"]},"fields":{"slug":"/blog/2020/04/25/cs/abstraction-of-programming-design-2-user-interface/"}}},{"node":{"id":"06cc88f1-000b-506b-8afb-0ba5409f5da1","frontmatter":{"title":"Haskell quick start","categories":["cs"],"tags":["haskell","beginner","plt","language"]},"fields":{"slug":"/blog/2019/12/08/cs/haskell-quick-start/"}}},{"node":{"id":"846c66d5-4f4a-5544-9491-fdc1671be380","frontmatter":{"title":"From Infinite Type to Functor","categories":["cs"],"tags":["plt","functor","language","haskell"]},"fields":{"slug":"/blog/2019/12/13/cs/from-infinite-type-to-functor/"}}},{"node":{"id":"b88e5107-daac-51de-aace-b9d13d01c5d1","frontmatter":{"title":"Reflection on Working effectively with legacy code --- chapter 6 to 10","categories":["cs"],"tags":["programming","testing"]},"fields":{"slug":"/blog/2019/12/07/cs/reflection-on-working-effectively-with-legacy-code-ch-6-10/"}}},{"node":{"id":"b9b6191e-1aa2-557b-9cbc-fcf4f689fe93","frontmatter":{"title":"Hindley-Milner type system: Incrementally build way & Make new language in Racket","categories":["cs"],"tags":["plt","hindley milner","racket"]},"fields":{"slug":"/blog/2020/05/24/cs/hindley-milner-system-incremental-build-and-make-new-language/"}}},{"node":{"id":"6759bad6-0b3f-5a19-b865-ee89d50703b4","frontmatter":{"title":"Magic in redux-go v2.1: package rematch","categories":["cs"],"tags":["golang","redux"]},"fields":{"slug":"/blog/2018/07/04/cs/magic-in-redux-go-2.1/"}}},{"node":{"id":"45c7c10b-ebe7-5f8a-9bb8-8384c90744cf","frontmatter":{"title":"Interaction with C in Zig","categories":["cs"],"tags":["zig","c","language"]},"fields":{"slug":"/blog/2019/12/22/cs/interaction-with-c-in-zig/"}}},{"node":{"id":"bce44484-82be-5531-bbc8-a9e1bc59076c","frontmatter":{"title":"Reflection on Working effectively with legacy code --- chapter 11 to 19","categories":["cs"],"tags":["programming","testing"]},"fields":{"slug":"/blog/2020/01/03/cs/reflection-on-working-effectively-with-legacy-code-ch-11-19/"}}},{"node":{"id":"602307b1-7619-55ee-91f4-b488361ff1fd","frontmatter":{"title":"","categories":["cs"],"tags":["programming","beginner","racket"]},"fields":{"slug":"/blog/2019/11/09/cs/abstraction-of-programming-design/"}}},{"node":{"id":"d29c9aa1-2b7f-531a-868a-ccdca6371411","frontmatter":{"title":"De Bruijn index: why and how","categories":["cs"],"tags":["plt","de bruijn index","racket"]},"fields":{"slug":"/blog/2020/05/16/cs/de-bruijn-index/"}}},{"node":{"id":"29b4fcc7-cbe5-57fd-a9c5-7a18c62d8ee6","frontmatter":{"title":" substitution ","categories":["cs"],"tags":["plt","utlc"]},"fields":{"slug":"/blog/2020/06/04/cs/how-hard-can-implement-substitution-correctly-be/"}}},{"node":{"id":"ab571f39-a304-515c-9e56-c4bdc3a1d70b","frontmatter":{"title":"Why Logic Programming?","categories":["cs"],"tags":["logic programming","racket","rosette","datalog"]},"fields":{"slug":"/blog/2020/07/15/cs/why-logic-programming/"}}},{"node":{"id":"97bb49ed-2ce6-588c-bd14-86dcecaa2116","frontmatter":{"title":"NOTE: Algebra Structure","categories":["math"],"tags":["note","algebra structure","magma","semigroup","monoid","group"]},"fields":{"slug":"/blog/2020/07/12/math/algebra-structure/"}}}]}},"pageContext":{"slug":"/blog/2019/05/18/cs/kubernetes-networking-concept-and-overview/"}}}