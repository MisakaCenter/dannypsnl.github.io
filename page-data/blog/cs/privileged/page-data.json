{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/cs/privileged/","result":{"data":{"markdownRemark":{"html":"<p>Just a record.</p>\n<p>At most of time, if we want to get into a node of kubernetes cluster, we can just using <code>ssh</code>. Or we would have a master node has public IP, then we first access the master than access workers to debug. However, in some environments that's impossible to do that. In my case, an AKS cluster, can't access nodes directly since we don't give it a public IP. What can we do now? Priviledged Pod!</p>\n<p>The YAML definition is:</p>\n<pre><code>apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: privileged\nspec:\n  selector:\n    matchLabels:\n      name: privileged-container\n  template:\n    metadata:\n      labels:\n        name: privileged-container\n    spec:\n      containers:\n      - name: busybox\n        image: busybox\n        resources:\n          limits:\n            cpu: 200m\n            memory: 100Mi\n          requests:\n            cpu: 100m\n            memory: 50Mi\n        stdin: true\n        securityContext:\n          privileged: true\n        volumeMounts:\n        - name: host-root-volume\n          mountPath: /host\n          readOnly: true\n      volumes:\n      - name: host-root-volume\n        hostPath:\n          path: /\n      hostNetwork: true\n      hostPID: true\n      restartPolicy: Always\n</code></pre>\n<p>The point is:</p>\n<pre><code>        volumeMounts:\n        - name: host-root-volume\n          mountPath: /host\n          readOnly: true\n</code></pre>\n<p>We mount the host path <code>/</code> to <code>/host</code> of the container. And we use host network: <code>hostNetwork: true</code> and host PID: <code>hostPID: true</code>.</p>\n<p>Use <code>DaemonSet</code> to ensure we can debug on each nodes.</p>\n<p>When we want to use the pod, using the command: <code>kubectl exec -ti privileged-xk23n chroot /host</code>.</p>","frontmatter":{"title":"Privileged Pod -- Debug kubernetes node"}}},"pageContext":{"slug":"/blog/cs/privileged/"}}}