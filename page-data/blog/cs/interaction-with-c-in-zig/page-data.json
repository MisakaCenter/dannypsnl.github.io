{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/cs/interaction-with-c-in-zig/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://dannypsnl.github.io"}},"markdownRemark":{"html":"<p>From 1972, <strong>C</strong> became more and more important in the underlying world. Many projects are based on <strong>C</strong>, including the famous operating system: <strong>Linux</strong>; the multi-platform toolkit for creating GUI: GTK; \"your friend\": Ruby and many others great software. <strong>C</strong> also introduces the <strong>pointer</strong>, I especially point out is because there has several <strong>pointer</strong> ways at that time, but the one used by <strong>C</strong> is the winner, and most people only know this version right now: at before, the pointer we have usually directly use size rather than object as its value, which means a pointer <code class=\"language-text\">p</code> which points to location <code class=\"language-text\">1</code>, after using the <code class=\"language-text\">p++</code> would point to location <code class=\"language-text\">2</code>; in <strong>C</strong>, the one we get used to, would depend on what is the object the <code class=\"language-text\">p</code> points to; that's why <code class=\"language-text\">x[i]</code> and <code class=\"language-text\">*(x + i)</code> are equivalent. From <a href=\"https://en.wikipedia.org/wiki/The_C_Programming_Language\">The C programming language</a>:</p>\n<blockquote>\n<p>As formal parameters in a function definition, char s[]; and char *s are equivalent.</p>\n</blockquote>\n<p><strong>C</strong> is an unbelievable simple language and makes so many great stuff, I think I can say it's a great language. But is not enough nowadays, let's take a look at a few examples:</p>\n<ul>\n<li>\n<p>where is my object?</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">object</span> <span class=\"token operator\">*</span><span class=\"token function\">new_object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">object</span> <span class=\"token operator\">*</span>obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>so, <code class=\"language-text\">char s[]</code> and <code class=\"language-text\">char *s</code> are equivalent?</p>\n<p>We have a global here:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Can I use</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">extern</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>s<span class=\"token punctuation\">;</span></code></pre></div>\n<p>to operate the origin one? No, but the following are the same</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">function</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> s<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">function</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">const</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>how to use boolean operations in <strong>C</strong>?</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>How about: <code class=\"language-text\">if (0x63)</code>?</p>\n</li>\n<li>\n<p>Can I point to that address?</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// so what is c?</span>\n<span class=\"token keyword\">char</span> c <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<p>Finally, we know <a href=\"https://www.slideshare.net/olvemaudal/insecure-coding-in-c-and-c\">how to kill ourself by creating a global thermonuclear war</a>, or because we don't know?</p>\n<h3>Future?</h3>\n<p>We make many tools and define many rules to avoid to make those errors in <strong>C</strong>. Like <a href=\"https://en.wikipedia.org/wiki/MISRA_C\">MISRA C</a>, <a href=\"https://en.wikipedia.org/wiki/List_of_model_checking_tools\">model checking</a> and more. Some of them are palliative, like define programming rules (unless that rule can be checked by linter, else is usually not really helpful), but some of them are very nice; here my point is focusing on the tool like <a href=\"https://www.fstar-lang.org/#introduction\">F*</a>.</p>\n<p>What I'm going to introduce is <strong>Zig</strong>. The first language which I really think it can be a replacement of <strong>C</strong>. The reason I think <strong>Zig</strong> is better is the concept of <strong>compile-time</strong> in <strong>Zig</strong>. Which means we can get the benefit from pre/post-condition checking. Let's have an example to know what's that means:</p>\n<div class=\"gatsby-highlight\" data-language=\"zig\"><pre class=\"language-zig\"><code class=\"language-zig\"><span class=\"token keyword\">fn</span> <span class=\"token function\">check_upper_case_name</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">comptime</span> str<span class=\"token punctuation\">:</span> <span class=\"token class-name\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token keyword\">const</span> <span class=\"token builtin-types keyword\">u8</span></span><span class=\"token punctuation\">)</span> <span class=\"token class-name\"><span class=\"token builtin-types keyword\">void</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">comptime</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> str<span class=\"token punctuation\">.</span>len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">>=</span> <span class=\"token string\">'a'</span> <span class=\"token keyword\">and</span> str<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;=</span> <span class=\"token string\">'z'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token builtin\">@compileError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"must be all uppercase\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// so if we typed `check_upper_case_name(\"apple\")`</span>\n<span class=\"token comment\">// would cause a compile error</span></code></pre></div>\n<p>This is a very powerful feature, but it's not enough to be a replacement of <strong>C</strong>. <strong>Rust</strong> has more features than <strong>C</strong> in the programming language designing view. It's not about performance, many languages can be faster than <strong>C</strong>(depends on the field of CS). The <strong>Go</strong> even as simple as <strong>C</strong>. But they cannot be a replacement of <strong>C</strong>. Because the interaction way is not simple enough, even have limitations (this is quite normal, it's caused by different languages design, I have mentioned <a href=\"/blog/cs/cgo-can-be-a-trouble/\">how cgo makes trouble</a>,\ncgo helps we link binary multiple times and must set up the linker flags multiple times, what a good idea!). Others language use FFI, in <strong>Rust</strong> we have to write:</p>\n<blockquote>\n<p>From <a href=\"https://doc.rust-lang.org/nomicon/ffi.html\">https://doc.rust-lang.org/nomicon/ffi.html</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token attribute attr-name\">#[link(name = \"snappy\")]</span>\n<span class=\"token keyword\">extern</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">snappy_max_compressed_length</span><span class=\"token punctuation\">(</span>source_length<span class=\"token punctuation\">:</span> size_t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> size_t<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Everything looks good, but FFI has a common limitation(I think the language use this model would have this problem): <a href=\"https://stackoverflow.com/questions/21485655/how-do-i-use-c-preprocessor-macros-with-rusts-ffi\">we cannot access the <code class=\"language-text\">#define</code> in <strong>C</strong></a>. You know, we can access macro in C is already confuse people and thought it is just a variable(but it's not). But <strong>C</strong> programs use <code class=\"language-text\">#define</code> for many things, like error number. So we are required to do so:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">const</span> A_C_ERROR_XXX<span class=\"token punctuation\">:</span> u32 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> A_C_ERROR_XXX2<span class=\"token punctuation\">:</span> u32 <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> A_C_ERROR_XXX3<span class=\"token punctuation\">:</span> u32 <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Hope you enjoy this process(or normally we would make a code generator and found the header location was changed after some versions).</p>\n<p><strong>Zig</strong> does a lot on making the interaction more convenience, that's why it can be the replacement of <strong>C</strong>. Not joking, let's see how to access existing <strong>C</strong> code from <strong>Zig</strong>.</p>\n<blockquote>\n<p>From <a href=\"https://github.com/dannypsnl/write-you-a-k8s/blob/master/test.zig\">https://github.com/dannypsnl/write-you-a-k8s/blob/master/test.zig</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"zig\"><pre class=\"language-zig\"><code class=\"language-zig\"><span class=\"token keyword\">const</span> c <span class=\"token operator\">=</span> <span class=\"token builtin\">@cImport</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">@cInclude</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"netlink/netlink.h\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">@cInclude</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"netlink/route/link.h\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We can even access macro:</p>\n<div class=\"gatsby-highlight\" data-language=\"zig\"><pre class=\"language-zig\"><code class=\"language-zig\"><span class=\"token keyword\">fn</span> <span class=\"token function\">netlink_err</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">:</span> <span class=\"token class-name\"><span class=\"token builtin-types keyword\">c_int</span></span><span class=\"token punctuation\">)</span> <span class=\"token class-name\"><span class=\"token operator\">!</span><span class=\"token builtin-types keyword\">void</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// error code is negative, we must convert it back first, so we use `-err`</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        c<span class=\"token punctuation\">.</span>NLE_SUCCESS <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_FAILURE <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>FAILURE<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_INTR <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>INTR<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_BAD_SOCK <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>BAD_SOCK<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_AGAIN <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>AGAIN<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_NOMEM <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>NOMEM<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_EXIST <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>EXIST<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_INVAL <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>INVAL<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_RANGE <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>RANGE<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_MSGSIZE <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>MSGSIZE<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_OPNOTSUPP <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>OPNOTSUPP<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_AF_NOSUPPORT <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>AF_NOSUPPORT<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_OBJ_NOTFOUND <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>OBJ_NOTFOUND<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_NOATTR <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>NOATTR<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_MISSING_ATTR <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>MISSING_ATTR<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_AF_MISMATCH <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>AF_MISMATCH<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_SEQ_MISMATCH <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>SEQ_MISMATCH<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_MSG_OVERFLOW <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>MSG_OVERFLOW<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_MSG_TRUNC <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>MSG_TRUNC<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_NOADDR <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>NOADDR<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_SRCRT_NOSUPPORT <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>SRCRT_NOSUPPORT<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_MSG_TOOSHORT <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>MSG_TOOSHORT<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_MSGTYPE_NOSUPPORT <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>MSGTYPE_NOSUPPORT<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_OBJ_MISMATCH <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>OBJ_MISMATCH<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_NOCACHE <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>NOCACHE<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_BUSY <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>BUSY<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_PROTO_MISMATCH <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>PROTO_MISMATCH<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_NOACCESS <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>NOACCESS<span class=\"token punctuation\">,</span>\n        c<span class=\"token punctuation\">.</span>NLE_PERM <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>PERM<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">else</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">return</span> NetLinkError<span class=\"token punctuation\">.</span>Unknown<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> NetLinkError <span class=\"token operator\">=</span> <span class=\"token keyword\">error</span><span class=\"token punctuation\">{</span>\n    Unknown<span class=\"token punctuation\">,</span>\n    FAILURE<span class=\"token punctuation\">,</span>\n    INTR<span class=\"token punctuation\">,</span>\n    BAD_SOCK<span class=\"token punctuation\">,</span>\n    AGAIN<span class=\"token punctuation\">,</span>\n    NOMEM<span class=\"token punctuation\">,</span>\n    EXIST<span class=\"token punctuation\">,</span>\n    INVAL<span class=\"token punctuation\">,</span>\n    RANGE<span class=\"token punctuation\">,</span>\n    MSGSIZE<span class=\"token punctuation\">,</span>\n    OPNOTSUPP<span class=\"token punctuation\">,</span>\n    AF_NOSUPPORT<span class=\"token punctuation\">,</span>\n    OBJ_NOTFOUND<span class=\"token punctuation\">,</span>\n    NOATTR<span class=\"token punctuation\">,</span>\n    MISSING_ATTR<span class=\"token punctuation\">,</span>\n    AF_MISMATCH<span class=\"token punctuation\">,</span>\n    SEQ_MISMATCH<span class=\"token punctuation\">,</span>\n    MSG_OVERFLOW<span class=\"token punctuation\">,</span>\n    MSG_TRUNC<span class=\"token punctuation\">,</span>\n    NOADDR<span class=\"token punctuation\">,</span>\n    SRCRT_NOSUPPORT<span class=\"token punctuation\">,</span>\n    MSG_TOOSHORT<span class=\"token punctuation\">,</span>\n    MSGTYPE_NOSUPPORT<span class=\"token punctuation\">,</span>\n    OBJ_MISMATCH<span class=\"token punctuation\">,</span>\n    NOCACHE<span class=\"token punctuation\">,</span>\n    BUSY<span class=\"token punctuation\">,</span>\n    PROTO_MISMATCH<span class=\"token punctuation\">,</span>\n    NOACCESS<span class=\"token punctuation\">,</span>\n    PERM<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Yes, <a href=\"http://charette.no-ip.com:81/programming/doxygen/netfilter/errno_8h.html\"><code class=\"language-text\">NLE_FAILURE</code> is macro</a>.</p>\n<p>But we cannot just take a look at how to code it, right? How about the build system? <strong>Zig</strong> use <strong>Zig</strong> as build script, and already has several helpful functionalities! Here is an example(file should be named <code class=\"language-text\">build.zig</code>):</p>\n<blockquote>\n<p>From <a href=\"https://github.com/dannypsnl/write-you-a-k8s/blob/master/build.zig\">https://github.com/dannypsnl/write-you-a-k8s/blob/master/build.zig</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"zig\"><pre class=\"language-zig\"><code class=\"language-zig\"><span class=\"token keyword\">const</span> Builder <span class=\"token operator\">=</span> <span class=\"token builtin\">@import</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"std\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>build<span class=\"token punctuation\">.</span>Builder<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">:</span> <span class=\"token class-name\"><span class=\"token operator\">*</span>Builder</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\"><span class=\"token builtin-types keyword\">void</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> exe <span class=\"token operator\">=</span> b<span class=\"token punctuation\">.</span><span class=\"token function\">addExecutable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test.zig\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    exe<span class=\"token punctuation\">.</span><span class=\"token function\">linkSystemLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"c\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    exe<span class=\"token punctuation\">.</span><span class=\"token function\">linkSystemLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nl-3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    exe<span class=\"token punctuation\">.</span><span class=\"token function\">linkSystemLibrary</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nl-route-3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    exe<span class=\"token punctuation\">.</span><span class=\"token function\">addIncludeDir</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/usr/include/libnl3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    exe<span class=\"token punctuation\">.</span><span class=\"token function\">install</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    b<span class=\"token punctuation\">.</span>default_step<span class=\"token punctuation\">.</span><span class=\"token function\">dependOn</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>exe<span class=\"token punctuation\">.</span>step<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We use <code class=\"language-text\">test.zig</code> to build an executable, link to <strong>C</strong> libraries <code class=\"language-text\">c</code>, <code class=\"language-text\">nl-3</code> and <code class=\"language-text\">nl-route-3</code>. Also, add an include directory for headers searching. All of them are the feature we exactly need when building a project works with <strong>C</strong>.</p>\n<h3>Conculsion</h3>\n<p>Now we got the idea why <strong>Zig</strong> is a proper replacement of <strong>C</strong>, so we should use it right now? For me is not, it points out the way we can move to. But itself is not complete enough for a production project, for example I haven't saught a package manager for <strong>Zig</strong>, seems like still in <a href=\"https://github.com/ziglang/zig/issues/943\">discussion</a>. So we can take a sit, and observe the future of <strong>Zig</strong>. Anyway, I really hope it can be successful. How about you?</p>","frontmatter":{"title":"Interaction with C in Zig","categories":["cs"],"tags":["zig","c","language"]}}},"pageContext":{"slug":"/blog/cs/interaction-with-c-in-zig/"}}}