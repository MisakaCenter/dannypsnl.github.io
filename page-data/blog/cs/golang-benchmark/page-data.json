{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/cs/golang-benchmark/","result":{"data":{"markdownRemark":{"html":"<p>Although the article is for Go, but you still can use concept part for others language.</p>\n<p>Frist we create a script called <code>bench_compare.sh</code>:</p>\n<pre><code class=\"language-bash\">if [ \"${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}\" != \"master\" ]; then\n    REMOTE_URL=\"$(git config --get remote.origin.url)\";\n    cd ${TRAVIS_BUILD_DIR}/.. &#x26;&#x26; \\\n    git clone ${REMOTE_URL} \"${TRAVIS_REPO_SLUG}-bench\" &#x26;&#x26; \\\n    cd \"${TRAVIS_REPO_SLUG}-bench\" &#x26;&#x26; \\\n    git checkout master &#x26;&#x26; \\\n    go test -bench . ./... > master_bench.out &#x26;&#x26; \\\n    git checkout ${TRAVIS_COMMIT} &#x26;&#x26; \\\n    go test -bench . ./... > current_bench.out &#x26;&#x26; \\\n    go get golang.org/x/tools/cmd/benchcmp &#x26;&#x26; \\\n    benchcmp master_bench.out current_bench.out;\nfi\n</code></pre>\n<p>Then I usually would execute it at <code>after_success</code> this section,\n<code>.travis.yml</code>:</p>\n<pre><code>script:\n  # testing part\nafter_success:\n  # ignore\n  - bash ./bench_compare.sh\n</code></pre>\n<p>p.s. write <code>script</code> part is just want to tell you it's located at that indention</p>\n<p>Now let me explain the script, basically we peek <code>${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}</code> is not <code>master</code> first.\nTo make sure we are not at <code>master</code> branch, if we are not at <code>master</code>, then we start to compare the benchmark result.\nHere has a point, <code>$(git config --get remote.origin.url)</code> is required, you can write <code>git checkout master</code> to know why.\nThen we checkout <code>master</code> and <code>${TRAVIS_COMMIT}</code>(I think this variable already tell you what is it), do benchmarking and store them.\nFinal step we download <code>golang.org/x/tools/cmd/benchcmp</code> for comparing, and compare two result file.</p>\n<p>To get more info, you can reference:</p>\n<ul>\n<li><a href=\"https://docs.travis-ci.com/user/environment-variables/#default-environment-variables\">travis default variables</a></li>\n<li><a href=\"godoc.org/golang.org/x/tools/cmd/benchcmp\">godoc.org/golang.org/x/tools/cmd/benchcmp</a></li>\n</ul>\n<p>Thanks for reading</p>","frontmatter":{"title":"How to compare Go benchmark in TravisCI"}}},"pageContext":{"slug":"/blog/cs/golang-benchmark/"}}}