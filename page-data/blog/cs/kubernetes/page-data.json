{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/cs/kubernetes/","result":{"data":{"markdownRemark":{"html":"<h2>Before you beginning</h2>\n<p>You should already install <code>kubectl</code> this command line tool.\nAnd knowing what is Kubernetes.\nKnowing why we need to separate the environment for the different member.</p>\n<h2>Config for demo</h2>\n<p>At first, we need to prepare a configuration that can help us learning operations of context.\nNow, create a file called <code>config_demo</code>.</p>\n<pre><code class=\"language-bash\">$ touch config_demo\n</code></pre>\n<p>Next, copy these contents into <code>config_demo</code>.</p>\n<pre><code class=\"language-yaml\">apiVersion: v1\nkind: Config\n\ncontexts:\n  - context:\n      cluster: \"\"\n      user: \"\"\n    name: backend\n  - context:\n      cluster: \"\"\n      user: \"\"\n    name: frontend\n</code></pre>\n<p>In our assuming, we have two kinds of developers, frontend &#x26; backend.</p>\n<p>Now, type <code>kubectl --kubeconfig config_demo config get-contexts</code>\nOutput:</p>\n<pre><code class=\"language-bash\">$ kubectl --kubeconfig config_demo config get-contexts\nCURRENT   NAME       CLUSTER   AUTHINFO   NAMESPACE\n          backend\n          frontend\n</code></pre>\n<p>See, we have two contexts now. Let's get into the next step.</p>\n<pre><code class=\"language-bash\">$ kubectl --kubeconfig config_demo config use-context backend\nSwitched to context \"backend\".\n</code></pre>\n<p>This command, obviously, change our context to <code>backend</code> now. But how do we checking this fact at other times? Here we go!</p>\n<pre><code class=\"language-bash\">$ kubectl --kubeconfig config_demo config current-context\nbackend\n</code></pre>\n<p>Ok, now we already know some basic operations of <code>kubectl config</code> this command, let's see the current content of your config file:</p>\n<pre><code class=\"language-yaml\">apiVersion: v1\nclusters: []\ncontexts:\n  - context:\n      cluster: \"\"\n      user: \"\"\n    name: backend\n  - context:\n      cluster: \"\"\n      user: \"\"\n    name: frontend\ncurrent-context: backend\nkind: Config\npreferences: {}\nusers: []\n</code></pre>\n<p>We got some new thing into it, but basically, the most important part is <code>current-context</code>, so now you know how <code>kubectl</code> store this info, then you know how to create this by modifying the config directly.</p>\n<p>Now, let's add some users to this config.</p>\n<pre><code class=\"language-yaml\">apiVersion: v1\n# ignore\nusers:\n  - name: frontend-developer\n  - name: backend-developer\n</code></pre>\n<p>Then add setting credentail for them</p>\n<pre><code class=\"language-bash\">$ kubectl --kubeconfig config_demo config set-credentials backend-developer --username=danny --password=danny\nUser \"backend-developer\" set.\n$ kubectl --kubeconfig config_demo config set-credentials frontend-developer --username=notme --password=notme\nUser \"frontend-developer\" set.\n</code></pre>\n<p>Now let's see what's different in the config</p>\n<pre><code class=\"language-yaml\">apiVersion: v1\n# ignore\nusers:\n  - name: backend-developer\n    user:\n      password: danny\n      username: danny\n  - name: frontend-developer\n    user:\n      password: notme\n      username: notme\n</code></pre>\n<p>p.s. Here, we use the basic auth, I won't suggest using this kind of auth in the real world and remember don't use the same value about username and password! I ever heard teacher use 1234 as a password when creating an example, and the student use 1234 even at work because used to do that, do make it happened to you!</p>\n<p>Let's go to the usage part, we would set up the user of the context</p>\n<pre><code class=\"language-bash\">$ kubectl --kubeconfig config_demo config set-context frontend --namespace frontend --user frontend-developer\nContext \"frontend\" modified.\n$ kubectl --kubeconfig config_demo config set-context backend --namespace backend --user backend-developer\nContext \"backend\" modified.\n</code></pre>\n<p>Then see the change inside of the config</p>\n<pre><code class=\"language-yaml\">apiVersion: v1\n# ignore\ncontexts:\n  - context:\n      cluster: \"\"\n      namespace: backend\n      user: backend-developer\n    name: backend\n  - context:\n      cluster: \"\"\n      namespace: frontend\n      user: frontend-developer\n    name: frontend\n</code></pre>\n<p>As you see, we didn't have a cluster so we can't do some operation, so now we would use the kubernetes for docker environment default cluster to do the following task. To do so, we have to add the cluster to the config</p>\n<pre><code class=\"language-yaml\">apiVersion: v1\n# ignore\n- context:\n    cluster: docker-for-desktop-cluster\n    namespace: backend\n    user: backend-developer\n  name: backend\n</code></pre>\n<p>And also do this for <code>frontend</code>, remember we didn't create a cluster, so you have included <code>~/.kube/config</code> on your computer to get <code>docker-for-desktop-cluster</code></p>\n<p>Once you do this, any operation on the cluster would require auth information, example:</p>\n<pre><code class=\"language-bash\">$ KUBECONFIG=~/.kube/config:config_demo kubectl get pod\nError from server (Forbidden): pods is forbidden: User \"system:anonymous\" cannot list pods in the namespace \"backend\"\n</code></pre>\n<p>p.s. Just a small tip: <code>po</code> as <code>pod</code> as <code>pods</code> in the command line.</p>\n<p>How to login the user is another part so I won't spend time on it but I can provide some references so that you can learn from those documentations. <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/authentication/\">https://kubernetes.io/docs/reference/access-authn-authz/authentication/</a></p>\n<h2>Practical</h2>\n<p>But what I said won't actually use in your job, unless you're kube-master or technical leader or somewhat anyway you have to operate these fundamental part in kubernetes. So here I would tell you how to use context correctly, that's set up <code>KUBECONFIG</code> this environment variable!</p>\n<p>In your <code>.bashrc</code>, <code>.zshrc</code> or anywhere, insert this:</p>\n<pre><code>export KUBECONFIG=$KUBECONFIG:config1:config2:config3\n</code></pre>\n<p>Where are configs from? Usually, are copying from your cloud platform, for example: <strong>Azure</strong>, <strong>GCP</strong>, <strong>AWS</strong>.</p>\n<p>Anyway, this config already contains context information, so after you set up your <code>KUBECONFIG</code>, you can see a lot of context by <code>kubectl config get-contexts</code>, then what you need is just use them!</p>\n<p>Thanks for reading, see you next time.</p>","frontmatter":{"title":"Kubernetes context"}}},"pageContext":{"slug":"/blog/cs/kubernetes/"}}}